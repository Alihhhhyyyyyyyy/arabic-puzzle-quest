<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic Puzzle Quest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .menu-screen {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .game-screen {
            display: none;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .category-btn {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .category-btn:active {
            transform: translateY(-2px);
        }

        .category-btn.general { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .category-btn.science { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .category-btn.history { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .category-btn.sports { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }

        .question-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .option {
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            text-align: right;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #e8ecff;
        }

        .option.correct {
            border-color: #4caf50;
            background: #e8f5e9;
            color: #2e7d32;
        }

        .option.incorrect {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .results-screen {
            display: none;
            text-align: center;
        }

        .score-display {
            font-size: 3em;
            color: #667eea;
            margin: 30px 0;
            font-weight: bold;
        }

        .message {
            font-size: 1.3em;
            color: #333;
            margin: 20px 0;
        }

        .loading {
            text-align: center;
            color: #667eea;
            font-size: 1.2em;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f44336;
        }

        .topic-info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
            text-align: center;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }

            .question-text {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§© Arabic Puzzle Quest</h1>
            <p class="subtitle">ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
        </header>

        <!-- Menu Screen -->
        <div id="menuScreen" class="menu-screen">
            <p style="text-align: center; color: #666; margin-bottom: 20px;">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ù‡Ø§</p>
            <div class="category-grid">
                <button class="category-btn general" onclick="startGame('general')">
                    ğŸ“š Ø¹Ø§Ù…<br><small>General</small>
                </button>
                <button class="category-btn science" onclick="startGame('science')">
                    ğŸ”¬ Ø§Ù„Ø¹Ù„ÙˆÙ…<br><small>Science</small>
                </button>
                <button class="category-btn history" onclick="startGame('history')">
                    ğŸ“œ Ø§Ù„ØªØ§Ø±ÙŠØ®<br><small>History</small>
                </button>
                <button class="category-btn sports" onclick="startGame('sports')">
                    âš½ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©<br><small>Sports</small>
                </button>
            </div>
            <div id="loadingMessage" class="loading" style="display: none;">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©... / Loading questions...
            </div>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="game-screen">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="topic-info" id="topicInfo"></div>

            <div class="question-container">
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="backToMenu()">Ø¹ÙˆØ¯Ø© / Back</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Ø§Ù„ØªØ§Ù„ÙŠ / Next</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="results-screen">
            <h2>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
            <h2 style="color: #666;">Final Results</h2>
            <div class="score-display" id="scoreDisplay">0/0</div>
            <div class="message" id="resultMessage"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="backToMenu()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© / Back to Menu</button>
            </div>
        </div>
    </div>

    <script>
        // Question Database with dynamic loading
        const questionsDB = {
            general: [],
            science: [],
            history: [],
            sports: []
        };

        // Topic mapping for general category
        const topicMapping = {
            'grammar': 'Grammar / Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯',
            'vocabulary': 'Vocabulary / Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª',
            'listening': 'Listening / Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹',
            'reading': 'Reading / Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©'
        };

        let currentCategory = '';
        let currentQuestion = 0;
        let score = 0;
        let selectedAnswer = null;
        let answered = false;

        // Initialize - Load all questions on page load
        async function initializeGame() {
            try {
                document.getElementById('loadingMessage').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';

                // Load all JSON files
                await loadQuestionsFromJSON('general', 'questions/general.json');
                await loadQuestionsFromJSON('science', 'questions/science.json');
                await loadQuestionsFromJSON('history', 'questions/history.json');
                await loadQuestionsFromJSON('sports', 'questions/sports.json');

                document.getElementById('loadingMessage').style.display = 'none';
                console.log('âœ“ All questions loaded successfully', questionsDB);
            } catch (error) {
                console.error('Error loading questions:', error);
                document.getElementById('loadingMessage').style.display = 'none';
                showError('Failed to load questions. Please refresh the page.');
            }
        }

        // Load questions from JSON file and convert to game format
        async function loadQuestionsFromJSON(category, filePath) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                questionsDB[category] = convertQuestionsFormat(data, category);
                console.log(`âœ“ Loaded ${questionsDB[category].length} questions from ${category}`);
            } catch (error) {
                console.error(`Error loading ${category} questions:`, error);
                throw error;
            }
        }

        // Convert JSON structure to game's question format
        function convertQuestionsFormat(data, category) {
            const convertedQuestions = [];

            // Handle different JSON structures
            if (Array.isArray(data)) {
                // Direct array of questions
                data.forEach((item, index) => {
                    const question = {
                        id: index + 1,
                        category: category,
                        topic: item.topic || mapCategoryToTopic(category, index),
                        question: item.question || item.text || item.q || '',
                        options: item.options || item.choices || item.answers || [],
                        correctAnswer: item.correctAnswer !== undefined ? item.correctAnswer : item.correct || 0,
                        explanation: item.explanation || item.hint || ''
                    };
                    
                    // Ensure options is an array
                    if (typeof question.options === 'object' && !Array.isArray(question.options)) {
                        question.options = Object.values(question.options);
                    }

                    if (question.question && question.options.length > 0) {
                        convertedQuestions.push(question);
                    }
                });
            } else if (data.questions && Array.isArray(data.questions)) {
                // Nested structure with questions property
                data.questions.forEach((item, index) => {
                    const question = {
                        id: index + 1,
                        category: category,
                        topic: item.topic || mapCategoryToTopic(category, index),
                        question: item.question || item.text || item.q || '',
                        options: item.options || item.choices || item.answers || [],
                        correctAnswer: item.correctAnswer !== undefined ? item.correctAnswer : item.correct || 0,
                        explanation: item.explanation || item.hint || ''
                    };

                    if (typeof question.options === 'object' && !Array.isArray(question.options)) {
                        question.options = Object.values(question.options);
                    }

                    if (question.question && question.options.length > 0) {
                        convertedQuestions.push(question);
                    }
                });
            }

            return convertedQuestions;
        }

        // Map category to appropriate topics
        function mapCategoryToTopic(category, index) {
            const topics = {
                'general': ['grammar', 'vocabulary', 'listening', 'reading'],
                'science': ['Science / Ø§Ù„Ø¹Ù„ÙˆÙ…'],
                'history': ['History / Ø§Ù„ØªØ§Ø±ÙŠØ®'],
                'sports': ['Sports / Ø§Ù„Ø±ÙŠØ§Ø¶Ø©']
            };

            const categoryTopics = topics[category] || ['General / Ø¹Ø§Ù…'];
            return categoryTopics[index % categoryTopics.length];
        }

        // Start the game with selected category
        function startGame(category) {
            if (questionsDB[category].length === 0) {
                showError(`No questions available for ${category}. Please try another category.`);
                return;
            }

            currentCategory = category;
            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;
            answered = false;

            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('resultsScreen').style.display = 'none';

            displayQuestion();
        }

        // Display current question
        function displayQuestion() {
            const questions = questionsDB[currentCategory];
            
            if (currentQuestion >= questions.length) {
                showResults();
                return;
            }

            const question = questions[currentQuestion];
            const progress = ((currentQuestion) / questions.length) * 100;

            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('topicInfo').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestion + 1} Ù…Ù† ${questions.length} | ${question.topic}`;
            document.getElementById('questionText').textContent = question.question;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectAnswer(index, question.correctAnswer);
                optionDiv.id = `option-${index}`;
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('nextBtn').disabled = true;
            selectedAnswer = null;
            answered = false;
        }

        // Select answer
        function selectAnswer(index, correctAnswer) {
            if (answered) return;

            selectedAnswer = index;
            answered = true;

            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                if (i === correctAnswer) {
                    opt.classList.add('correct');
                } else if (i === index && index !== correctAnswer) {
                    opt.classList.add('incorrect');
                }
                opt.style.pointerEvents = 'none';
            });

            if (index === correctAnswer) {
                score++;
            }

            document.getElementById('nextBtn').disabled = false;
        }

        // Next question
        function nextQuestion() {
            currentQuestion++;
            displayQuestion();
        }

        // Show results
        function showResults() {
            const totalQuestions = questionsDB[currentCategory].length;
            const percentage = Math.round((score / totalQuestions) * 100);

            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';

            document.getElementById('scoreDisplay').textContent = `${score} / ${totalQuestions}`;

            let message = '';
            if (percentage === 100) {
                message = 'ğŸ† Perfect Score! You are a master! | Ù†ØªÙŠØ¬Ø© Ù…Ø«Ø§Ù„ÙŠØ©! Ø£Ù†Øª Ù…ØªÙ‚Ù†!';
            } else if (percentage >= 80) {
                message = 'â­ Excellent! You did great! | Ù…Ù…ØªØ§Ø²! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!';
            } else if (percentage >= 60) {
                message = 'ğŸ‘ Good job! Keep practicing! | Ø¬ÙŠØ¯! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¯Ø±ÙŠØ¨!';
            } else if (percentage >= 40) {
                message = 'ğŸ“š You need more practice. Try again! | ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨!';
            } else {
                message = 'ğŸ’ª Keep learning! You will improve! | Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù…! Ø³ØªØªØ­Ø³Ù†!';
            }

            document.getElementById('resultMessage').innerHTML = `
                <div>${message}</div>
                <div style="margin-top: 15px; color: #667eea; font-size: 1.1em;">
                    ${percentage}% Accuracy | Ø¯Ù‚Ø© ${percentage}%
                </div>
            `;
        }

        // Back to menu
        function backToMenu() {
            document.getElementById('menuScreen').style.display = 'flex';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'none';
            selectedAnswer = null;
            answered = false;
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Initialize game on page load
        window.addEventListener('load', initializeGame);
    </script>
</body>
</html>